{% doc %}
  @prompt
    Create a simple testimonials section with two testimonials displayed side by side. Each testimonial should have the testimonial text and the customer name below it. Include left and right arrow navigation buttons below the testimonials to toggle between different sets of testimonials. Make sure all testimonial content and names are fully editable through the theme customizer settings so the merchant can easily change and update them., not bad remove the literal quotes and left justify the text and decrease the size of each testimonial card slightly on the sides and give me functionality to move through them via two buttons left and right, keep the name justified to the bottom left corner of the card regardless of the whitespace in between
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-testimonials-container-{{ ai_gen_id }} {
    padding: 40px 20px;
    background-color: {{ block.settings.background_color }};
    border-radius: {{ block.settings.border_radius }}px;
    max-width: 100%;
  }

  .ai-testimonials-wrapper-{{ ai_gen_id }} {
    max-width: 1200px;
    margin: 0 auto;
  }

  .ai-testimonials-header-{{ ai_gen_id }} {
    text-align: center;
    margin-bottom: 40px;
  }

  .ai-testimonials-title-{{ ai_gen_id }} {
    color: {{ block.settings.text_color }};
    font-size: {{ block.settings.title_size }}px;
    margin: 0 0 16px;
    font-family: {{ settings.type_header_font.family }}, {{ settings.type_header_font.fallback_families }};
    font-weight: {{ settings.type_header_font.weight }};
  }

  .ai-testimonials-subtitle-{{ ai_gen_id }} {
    color: {{ block.settings.text_color }};
    font-size: {{ block.settings.subtitle_size }}px;
    margin: 0;
    opacity: 0.8;
  }

  .ai-testimonials-content-{{ ai_gen_id }} {
    position: relative;
    overflow: hidden;
  }

  .ai-testimonials-track-{{ ai_gen_id }} {
    display: flex;
    transition: transform 0.5s ease;
    width: 100%;
  }

  .ai-testimonials-slide-{{ ai_gen_id }} {
    min-width: 100%;
    display: flex;
    gap: 30px;
    padding: 0 40px;
  }

  .ai-testimonial-card-{{ ai_gen_id }} {
    flex: 1;
    background-color: {{ block.settings.card_background_color }};
    padding: 30px;
    border-radius: {{ block.settings.card_border_radius }}px;
    text-align: left;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    border: 1px solid {{ block.settings.card_border_color }};
    display: flex;
    flex-direction: column;
    min-height: 200px;
  }

  .ai-testimonial-text-{{ ai_gen_id }} {
    color: {{ block.settings.testimonial_text_color }};
    font-size: {{ block.settings.testimonial_text_size }}px;
    line-height: 1.6;
    margin-bottom: 20px;
    font-style: italic;
    flex-grow: 1;
  }

  .ai-testimonial-author-{{ ai_gen_id }} {
    color: {{ block.settings.author_text_color }};
    font-size: {{ block.settings.author_text_size }}px;
    font-weight: 600;
    margin: 0;
    margin-top: auto;
    align-self: flex-start;
  }

  .ai-testimonials-navigation-{{ ai_gen_id }} {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    margin-top: 40px;
  }

  .ai-testimonials-nav-button-{{ ai_gen_id }} {
    background-color: {{ block.settings.nav_button_color }};
    color: {{ block.settings.nav_button_text_color }};
    border: none;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .ai-testimonials-nav-button-{{ ai_gen_id }}:hover {
    background-color: {{ block.settings.nav_button_hover_color }};
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  .ai-testimonials-nav-button-{{ ai_gen_id }}:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
  }

  .ai-testimonials-nav-button-{{ ai_gen_id }} svg {
    width: 20px;
    height: 20px;
  }

  .ai-testimonials-indicators-{{ ai_gen_id }} {
    display: flex;
    gap: 8px;
  }

  .ai-testimonials-indicator-{{ ai_gen_id }} {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background-color: {{ block.settings.indicator_color }};
    opacity: 0.3;
    cursor: pointer;
    transition: opacity 0.3s ease;
  }

  .ai-testimonials-indicator-{{ ai_gen_id }}.active {
    opacity: 1;
  }

  @media screen and (max-width: 768px) {
    .ai-testimonials-slide-{{ ai_gen_id }} {
      flex-direction: column;
      gap: 20px;
      padding: 0 20px;
    }

    .ai-testimonial-card-{{ ai_gen_id }} {
      padding: 20px;
    }

    .ai-testimonials-container-{{ ai_gen_id }} {
      padding: 30px 15px;
    }
  }
{% endstyle %}

<testimonials-slider-{{ ai_gen_id }}
  class="ai-testimonials-container-{{ ai_gen_id }}"
  {{ block.shopify_attributes }}
>
  <div class="ai-testimonials-wrapper-{{ ai_gen_id }}">
    {% if block.settings.title != blank or block.settings.subtitle != blank %}
      <div class="ai-testimonials-header-{{ ai_gen_id }}">
        {% if block.settings.title != blank %}
          <h2 class="ai-testimonials-title-{{ ai_gen_id }}">{{ block.settings.title }}</h2>
        {% endif %}
        {% if block.settings.subtitle != blank %}
          <p class="ai-testimonials-subtitle-{{ ai_gen_id }}">{{ block.settings.subtitle }}</p>
        {% endif %}
      </div>
    {% endif %}

    <div class="ai-testimonials-content-{{ ai_gen_id }}">
      <div class="ai-testimonials-track-{{ ai_gen_id }}" data-track>
        {% assign total_slides = 0 %}
        {% for i in (1..10) %}
          {% liquid
            assign testimonial_1_key = 'testimonial_' | append: i | append: '_1_text'
            assign author_1_key = 'testimonial_' | append: i | append: '_1_author'
            assign testimonial_2_key = 'testimonial_' | append: i | append: '_2_text'
            assign author_2_key = 'testimonial_' | append: i | append: '_2_author'
            
            assign testimonial_1_text = block.settings[testimonial_1_key]
            assign author_1 = block.settings[author_1_key]
            assign testimonial_2_text = block.settings[testimonial_2_key]
            assign author_2 = block.settings[author_2_key]
          %}

          {% if testimonial_1_text != blank or author_1 != blank or testimonial_2_text != blank or author_2 != blank %}
            {% assign total_slides = total_slides | plus: 1 %}
            <div class="ai-testimonials-slide-{{ ai_gen_id }}">
              <div class="ai-testimonial-card-{{ ai_gen_id }}">
                <div class="ai-testimonial-text-{{ ai_gen_id }}">
                  {% if testimonial_1_text != blank %}
                    {{ testimonial_1_text }}
                  {% else %}
                    Add your first testimonial text here
                  {% endif %}
                </div>
                <p class="ai-testimonial-author-{{ ai_gen_id }}">
                  {% if author_1 != blank %}
                    {{ author_1 }}
                  {% else %}
                    Customer Name
                  {% endif %}
                </p>
              </div>

              <div class="ai-testimonial-card-{{ ai_gen_id }}">
                <div class="ai-testimonial-text-{{ ai_gen_id }}">
                  {% if testimonial_2_text != blank %}
                    {{ testimonial_2_text }}
                  {% else %}
                    Add your second testimonial text here
                  {% endif %}
                </div>
                <p class="ai-testimonial-author-{{ ai_gen_id }}">
                  {% if author_2 != blank %}
                    {{ author_2 }}
                  {% else %}
                    Customer Name
                  {% endif %}
                </p>
              </div>
            </div>
          {% endif %}
        {% endfor %}

        {% if total_slides == 0 %}
          <div class="ai-testimonials-slide-{{ ai_gen_id }}">
            <div class="ai-testimonial-card-{{ ai_gen_id }}">
              <div class="ai-testimonial-text-{{ ai_gen_id }}">
                This product exceeded my expectations! The quality is outstanding and the customer service was exceptional.
              </div>
              <p class="ai-testimonial-author-{{ ai_gen_id }}">Sarah Johnson</p>
            </div>

            <div class="ai-testimonial-card-{{ ai_gen_id }}">
              <div class="ai-testimonial-text-{{ ai_gen_id }}">
                I've been using this for months now and couldn't be happier. Highly recommend to anyone looking for quality.
              </div>
              <p class="ai-testimonial-author-{{ ai_gen_id }}">Michael Chen</p>
            </div>
          </div>
        {% endif %}
      </div>
    </div>

    {% if total_slides > 1 %}
      <div class="ai-testimonials-navigation-{{ ai_gen_id }}">
        <button
          class="ai-testimonials-nav-button-{{ ai_gen_id }}"
          data-prev
          aria-label="Previous testimonials"
        >
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="15,18 9,12 15,6"></polyline>
          </svg>
        </button>

        <div class="ai-testimonials-indicators-{{ ai_gen_id }}" data-indicators>
          {% for i in (1..total_slides) %}
            <button
              class="ai-testimonials-indicator-{{ ai_gen_id }} {% if forloop.first %}active{% endif %}"
              data-slide="{{ forloop.index0 }}"
              aria-label="Go to slide {{ forloop.index }}"
            ></button>
          {% endfor %}
        </div>

        <button
          class="ai-testimonials-nav-button-{{ ai_gen_id }}"
          data-next
          aria-label="Next testimonials"
        >
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="9,18 15,12 9,6"></polyline>
          </svg>
        </button>
      </div>
    {% else %}
      <div class="ai-testimonials-navigation-{{ ai_gen_id }}">
        <button
          class="ai-testimonials-nav-button-{{ ai_gen_id }}"
          data-prev
          aria-label="Previous testimonials"
        >
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="15,18 9,12 15,6"></polyline>
          </svg>
        </button>

        <button
          class="ai-testimonials-nav-button-{{ ai_gen_id }}"
          data-next
          aria-label="Next testimonials"
        >
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="9,18 15,12 9,6"></polyline>
          </svg>
        </button>
      </div>
    {% endif %}
  </div>
</testimonials-slider-{{ ai_gen_id }}>

<script>
  (function() {
    class TestimonialsSlider{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
        this.currentSlide = 0;
        this.totalSlides = 0;
      }

      connectedCallback() {
        this.track = this.querySelector('[data-track]');
        this.slides = this.querySelectorAll('.ai-testimonials-slide-{{ ai_gen_id }}');
        this.prevButton = this.querySelector('[data-prev]');
        this.nextButton = this.querySelector('[data-next]');
        this.indicators = this.querySelectorAll('.ai-testimonials-indicator-{{ ai_gen_id }}');
        
        this.totalSlides = this.slides.length;
        
        this.setupEventListeners();
        this.updateSlider();
      }

      setupEventListeners() {
        if (this.prevButton) {
          this.prevButton.addEventListener('click', () => this.goToPrevSlide());
        }
        
        if (this.nextButton) {
          this.nextButton.addEventListener('click', () => this.goToNextSlide());
        }
        
        this.indicators.forEach((indicator, index) => {
          indicator.addEventListener('click', () => this.goToSlide(index));
        });

        let startX = 0;
        let currentX = 0;
        let isDragging = false;

        this.track.addEventListener('touchstart', (e) => {
          startX = e.touches[0].clientX;
          isDragging = true;
        });

        this.track.addEventListener('touchmove', (e) => {
          if (!isDragging) return;
          currentX = e.touches[0].clientX;
        });

        this.track.addEventListener('touchend', () => {
          if (!isDragging) return;
          isDragging = false;
          
          const diff = startX - currentX;
          if (Math.abs(diff) > 50) {
            if (diff > 0) {
              this.goToNextSlide();
            } else {
              this.goToPrevSlide();
            }
          }
        });
      }

      goToPrevSlide() {
        if (this.totalSlides <= 1) return;
        this.currentSlide = this.currentSlide === 0 ? this.totalSlides - 1 : this.currentSlide - 1;
        this.updateSlider();
      }

      goToNextSlide() {
        if (this.totalSlides <= 1) return;
        this.currentSlide = this.currentSlide === this.totalSlides - 1 ? 0 : this.currentSlide + 1;
        this.updateSlider();
      }

      goToSlide(index) {
        this.currentSlide = index;
        this.updateSlider();
      }

      updateSlider() {
        if (this.track) {
          this.track.style.transform = `translateX(-${this.currentSlide * 100}%)`;
        }

        this.indicators.forEach((indicator, index) => {
          indicator.classList.toggle('active', index === this.currentSlide);
        });
      }
    }

    customElements.define('testimonials-slider-{{ ai_gen_id }}', TestimonialsSlider{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "Testimonials slider",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Section header"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "What our customers say"
    },
    {
      "type": "text",
      "id": "subtitle",
      "label": "Subtitle",
      "default": "Don't just take our word for it"
    },
    {
      "type": "range",
      "id": "title_size",
      "min": 20,
      "max": 60,
      "step": 2,
      "unit": "px",
      "label": "Title size",
      "default": 32
    },
    {
      "type": "range",
      "id": "subtitle_size",
      "min": 14,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Subtitle size",
      "default": 16
    },
    {
      "type": "header",
      "content": "Testimonial set 1"
    },
    {
      "type": "textarea",
      "id": "testimonial_1_1_text",
      "label": "First testimonial text",
      "default": "This product exceeded my expectations! The quality is outstanding and the customer service was exceptional."
    },
    {
      "type": "text",
      "id": "testimonial_1_1_author",
      "label": "First customer name",
      "default": "Sarah Johnson"
    },
    {
      "type": "textarea",
      "id": "testimonial_1_2_text",
      "label": "Second testimonial text",
      "default": "I've been using this for months now and couldn't be happier. Highly recommend to anyone looking for quality."
    },
    {
      "type": "text",
      "id": "testimonial_1_2_author",
      "label": "Second customer name",
      "default": "Michael Chen"
    },
    {
      "type": "header",
      "content": "Testimonial set 2"
    },
    {
      "type": "textarea",
      "id": "testimonial_2_1_text",
      "label": "First testimonial text"
    },
    {
      "type": "text",
      "id": "testimonial_2_1_author",
      "label": "First customer name"
    },
    {
      "type": "textarea",
      "id": "testimonial_2_2_text",
      "label": "Second testimonial text"
    },
    {
      "type": "text",
      "id": "testimonial_2_2_author",
      "label": "Second customer name"
    },
    {
      "type": "header",
      "content": "Testimonial set 3"
    },
    {
      "type": "textarea",
      "id": "testimonial_3_1_text",
      "label": "First testimonial text"
    },
    {
      "type": "text",
      "id": "testimonial_3_1_author",
      "label": "First customer name"
    },
    {
      "type": "textarea",
      "id": "testimonial_3_2_text",
      "label": "Second testimonial text"
    },
    {
      "type": "text",
      "id": "testimonial_3_2_author",
      "label": "Second customer name"
    },
    {
      "type": "header",
      "content": "Testimonial set 4"
    },
    {
      "type": "textarea",
      "id": "testimonial_4_1_text",
      "label": "First testimonial text"
    },
    {
      "type": "text",
      "id": "testimonial_4_1_author",
      "label": "First customer name"
    },
    {
      "type": "textarea",
      "id": "testimonial_4_2_text",
      "label": "Second testimonial text"
    },
    {
      "type": "text",
      "id": "testimonial_4_2_author",
      "label": "Second customer name"
    },
    {
      "type": "header",
      "content": "Testimonial set 5"
    },
    {
      "type": "textarea",
      "id": "testimonial_5_1_text",
      "label": "First testimonial text"
    },
    {
      "type": "text",
      "id": "testimonial_5_1_author",
      "label": "First customer name"
    },
    {
      "type": "textarea",
      "id": "testimonial_5_2_text",
      "label": "Second testimonial text"
    },
    {
      "type": "text",
      "id": "testimonial_5_2_author",
      "label": "Second customer name"
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#fcfcfc"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color",
      "default": "#103948"
    },
    {
      "type": "color",
      "id": "card_background_color",
      "label": "Card background color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "card_border_color",
      "label": "Card border color",
      "default": "#ebeced"
    },
    {
      "type": "color",
      "id": "testimonial_text_color",
      "label": "Testimonial text color",
      "default": "#103948"
    },
    {
      "type": "color",
      "id": "author_text_color",
      "label": "Author text color",
      "default": "#103948"
    },
    {
      "type": "color",
      "id": "nav_button_color",
      "label": "Navigation button color",
      "default": "#103948"
    },
    {
      "type": "color",
      "id": "nav_button_text_color",
      "label": "Navigation button text color",
      "default": "#fcfcfc"
    },
    {
      "type": "color",
      "id": "nav_button_hover_color",
      "label": "Navigation button hover color",
      "default": "#18566c"
    },
    {
      "type": "color",
      "id": "indicator_color",
      "label": "Indicator color",
      "default": "#103948"
    },
    {
      "type": "header",
      "content": "Typography"
    },
    {
      "type": "range",
      "id": "testimonial_text_size",
      "min": 14,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Testimonial text size",
      "default": 16
    },
    {
      "type": "range",
      "id": "author_text_size",
      "min": 12,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Author text size",
      "default": 14
    },
    {
      "type": "header",
      "content": "Style"
    },
    {
      "type": "range",
      "id": "border_radius",
      "min": 0,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Section border radius",
      "default": 0
    },
    {
      "type": "range",
      "id": "card_border_radius",
      "min": 0,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Card border radius",
      "default": 8
    }
  ],
  "presets": [
    {
      "name": "Testimonials slider"
    }
  ]
}
{% endschema %}